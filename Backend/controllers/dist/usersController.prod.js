"use strict";function _templateObject15(){var e=_taggedTemplateLiteral(["DELETE FROM adoptedPets WHERE user_ID = ",""]);return _templateObject15=function(){return e},e}function _templateObject14(){var e=_taggedTemplateLiteral(["DELETE FROM savedPets WHERE user_ID = ",""]);return _templateObject14=function(){return e},e}function _templateObject13(){var e=_taggedTemplateLiteral(['UPDATE pets JOIN adoptedPets on pets.pet_ID = adoptedPets.pet_ID SET adoption_status = "available", availability = true WHERE user_ID = '," "]);return _templateObject13=function(){return e},e}function _templateObject12(){var e=_taggedTemplateLiteral(["UPDATE users SET admin_status = TRUE  WHERE user_ID = ",""]);return _templateObject12=function(){return e},e}function _templateObject11(){var e=_taggedTemplateLiteral(["DELETE FROM enquiry WHERE enquiry_ID = ",""]);return _templateObject11=function(){return e},e}function _templateObject10(){var e=_taggedTemplateLiteral(["UPDATE enquiry SET admin_ID = ",", admin_Email = ",', status = "resolved" WHERE enquiry_ID = ',""]);return _templateObject10=function(){return e},e}function _templateObject9(){var e=_taggedTemplateLiteral(["UPDATE enquiry SET admin_ID = ",", admin_Email = ",', status = "in progress" WHERE enquiry_ID = ',""]);return _templateObject9=function(){return e},e}function _templateObject8(){var e=_taggedTemplateLiteral(["INSERT INTO enquiry (user_ID, enquiry_ID, user_Email, first_name, last_name, phone, enquiry, date_created) VALUES (",", ",", ",", ",", ",", ",", ",", ",")"]);return _templateObject8=function(){return e},e}function _templateObject7(){var e=_taggedTemplateLiteral(["SELECT * FROM pets JOIN adoptedPets on pets.pet_ID = adoptedPets.pet_ID WHERE user_ID = ",""]);return _templateObject7=function(){return e},e}function _templateObject6(){var e=_taggedTemplateLiteral(["SELECT * FROM enquiry"]);return _templateObject6=function(){return e},e}function _templateObject5(){var e=_taggedTemplateLiteral(["SELECT * FROM newsfeed"]);return _templateObject5=function(){return e},e}function _templateObject4(){var e=_taggedTemplateLiteral(["SELECT user_ID, email, first_name, last_name, phone, bio, date_created, admin_status FROM users"]);return _templateObject4=function(){return e},e}function _templateObject3(){var e=_taggedTemplateLiteral(["UPDATE users SET email = ",", first_name = ",", last_name = ",", phone = ",", bio = "," WHERE user_ID = ",""]);return _templateObject3=function(){return e},e}function _templateObject2(){var e=_taggedTemplateLiteral(["UPDATE users SET password = "," WHERE user_ID = ",""]);return _templateObject2=function(){return e},e}function _templateObject(){var e=_taggedTemplateLiteral(["INSERT INTO users (user_ID, email, password, first_name, last_name, phone, admin_status, bio) VALUES (",", ",", ",", ",", ",", ",", ",", '')"]);return _templateObject=function(){return e},e}function _taggedTemplateLiteral(e,t){return t=t||e.slice(0),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var SQL=require("@nearform/sql"),_require=require("uuid"),uuidv4=_require.v4,_require2=require("../lib/mysql"),query=_require2.query;exports.login=function(e,t){try{var r=e.token;t.send({token:r,userInfo:e.body.user,message:"Login Success!"})}catch(e){console.log(e),t.status(500).send(e.message)}},exports.signUpUser=function(t,r){var n,a,s,u,c,o,i,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body,a=n.email,s=n.password,u=n.firstName,c=n.lastName,o=n.phoneNumber,i=n.admin,l=uuidv4(),e.next=5,regeneratorRuntime.awrap(query(SQL(_templateObject(),l,a.toLowerCase(),s,u,c,o,i)));case 5:if(!0===i)return e.next=8,regeneratorRuntime.awrap(query('INSERT INTO newsfeed (news) VALUES ("New Admin User! Email: '.concat(a," Name: ").concat(u," ").concat(c,'!")')));e.next=11;break;case 8:e.sent,e.next=14;break;case 11:return e.next=13,regeneratorRuntime.awrap(query('INSERT INTO newsfeed (news) VALUES ("New Public User! Email: '.concat(a," Name: ").concat(u," ").concat(c,'!")')));case 13:e.sent;case 14:r.send("Register Succesful!"),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 21:case"end":return e.stop()}},null,null,[[0,17]])},exports.updateUserPassword=function(t,r){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body.password,a=t.decoded.userID,e.next=5,regeneratorRuntime.awrap(query(SQL(_templateObject2(),n,a)));case 5:r.send("Updated Password Succesfully!"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 12:case"end":return e.stop()}},null,null,[[0,8]])},exports.updateUserProfile=function(t,r){var n,a,s,u,c,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body,a=n.email,s=n.firstName,u=n.lastName,c=n.phoneNumber,o=n.bio,i=t.decoded.userID,e.next=5,regeneratorRuntime.awrap(query(SQL(_templateObject3(),a,s,u,c,o,i)));case 5:e.sent,r.send("Updated Profile Succesfully!"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 13:case"end":return e.stop()}},null,null,[[0,9]])},exports.adminUserNewsfeedArrays=function(e,t){var r,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(query(SQL(_templateObject4())));case 3:return r=e.sent,e.next=6,regeneratorRuntime.awrap(query(SQL(_templateObject5())));case 6:return n=e.sent,e.next=9,regeneratorRuntime.awrap(query(SQL(_templateObject6())));case 9:a=e.sent,t.send({usersArray:r,newsfeedArray:n,enquiryArray:a}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0),t.status(500).send(e.t0.message);case 17:case"end":return e.stop()}},null,null,[[0,13]])},exports.getViewedUsersPets=function(t,r){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.query.viewedUserID,e.next=4,regeneratorRuntime.awrap(query(SQL(_templateObject7(),n)));case 4:a=e.sent,r.send(a),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 12:case"end":return e.stop()}},null,null,[[0,8]])},exports.sendEnquiry=function(t,r){var n,a,s,u,c,o,i,l,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body,a=n.email,s=n.firstName,u=n.lastName,c=n.phone,o=n.enquiry,i=t.decoded.userID,l=uuidv4(),p=(new Date).toJSON().slice(0,19).replace("T"," "),e.next=7,regeneratorRuntime.awrap(query(SQL(_templateObject8(),i,l,a,s,u,c,o,p)));case 7:return e.sent,e.next=10,regeneratorRuntime.awrap(query('INSERT INTO newsfeed (news) VALUES ("New Enquiry! Email: '.concat(a," Name: ").concat(s," ").concat(u,' has sent an enquiry!")')));case 10:e.sent,r.send("Enquiry Sent Succesful!"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 18:case"end":return e.stop()}},null,null,[[0,14]])},exports.enquiryToInProgress=function(t,r){var n,a,s,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body,a=n.enquiryID,s=n.adminEmail,u=n.userEmail,c=t.decoded.userID,e.next=5,regeneratorRuntime.awrap(query(SQL(_templateObject9(),c,s,a)));case 5:return e.sent,e.next=8,regeneratorRuntime.awrap(query('INSERT INTO newsfeed (news) VALUES ("Enquiry Status Change! Admin: '.concat(s," now resolving ").concat(u,' enquiry")')));case 8:e.sent,r.send("Updated Enquiry Succesfully!"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 16:case"end":return e.stop()}},null,null,[[0,12]])},exports.enquiryToResolved=function(t,r){var n,a,s,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body,a=n.enquiryID,s=n.adminEmail,u=n.userEmail,c=t.decoded.userID,e.next=5,regeneratorRuntime.awrap(query(SQL(_templateObject10(),c,s,a)));case 5:return e.sent,e.next=8,regeneratorRuntime.awrap(query('INSERT INTO newsfeed (news) VALUES ("Enquiry Status Change! Admin: '.concat(s," has resolved ").concat(u,' enquiry!")')));case 8:e.sent,r.send("Updated Enquiry Succesfully!"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 16:case"end":return e.stop()}},null,null,[[0,12]])},exports.enquiryToDelete=function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.enquiryID,e.next=4,regeneratorRuntime.awrap(query(SQL(_templateObject11(),n)));case 4:e.sent,r.send("Deleted Enquiry Succesfully!"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 12:case"end":return e.stop()}},null,null,[[0,8]])},exports.enquirySearch=function(t,r){var n,a,s,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.query,a=n.email,s=n.date,e.next=4,regeneratorRuntime.awrap(query("SELECT * FROM enquiry WHERE user_Email LIKE '%".concat(a,"%' AND date_created LIKE '%").concat(s,"%'")));case 4:u=e.sent,r.send(u),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 12:case"end":return e.stop()}},null,null,[[0,8]])},exports.makeAdmin=function(t,r){var n,a,s,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body,a=n.adminEmail,s=n.publicUserEmail,u=n.publicUserID,e.next=4,regeneratorRuntime.awrap(query(SQL(_templateObject12(),u)));case 4:return e.sent,e.next=7,regeneratorRuntime.awrap(query(SQL(_templateObject13(),u)));case 7:return e.sent,e.next=10,regeneratorRuntime.awrap(query(SQL(_templateObject14(),u)));case 10:return e.sent,e.next=13,regeneratorRuntime.awrap(query(SQL(_templateObject15(),u)));case 13:return e.sent,e.next=16,regeneratorRuntime.awrap(query('INSERT INTO newsfeed (news) VALUES ("Admin: '.concat(a," has made ").concat(s,' an admin!")')));case 16:e.sent,r.send("Updated Admin Succesfully!"),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 24:case"end":return e.stop()}},null,null,[[0,20]])};
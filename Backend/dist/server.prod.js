"use strict";var app=require("./app"),_require=require("./lib/mysql"),postgrator=_require.postgrator,port=process.env.PORT||5e3;postgrator.migrate().then(function(e){console.log("migrated succesfully!",e),app.listen(port,function(){console.log("Listening on port ".concat(port,"..."))})}).catch(function(e){return console.error(e)});var webSocketsServerPort=8e3,webSocketServer=require("websocket").server,http=require("http"),server=http.createServer();server.listen(webSocketsServerPort),console.log("listening on port 8000");var wsServer=new webSocketServer({httpServer:server}),clients={},getUniqueID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()};wsServer.on("request",function(e){var r=getUniqueID();console.log(new Date+" Recieved a new connection from origin "+e.origin+".");var t=e.accept(null,e.origin);clients[r]=t,console.log("connected: "+r+" in "+Object.getOwnPropertyNames(clients)),t.on("message",function(e){if("utf8"===e.type)for(key in console.log("Received Message: ",e.utf8Data),clients)clients[key].sendUTF(e.utf8Data),console.log("sent Message to: ",clients[key])})});